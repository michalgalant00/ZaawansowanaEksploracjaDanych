---
title: "heights and weights around the world"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(ggplot2)
library(plotly)
library(plyr)
library(dplyr)
library(flexdashboard)


file = "./allCountries.RData"
data = readRDS(file)

# dane dla Francji
fr_data = subset(data, country == 'FR')

```


France data
=======================================================================

Column
-----------------------------------------------------------------------

### Distribution of weights for the years 1880 and 1980

```{r}

p = ggplot(fr_data, aes(x = height, fill = factor(year))) +
  geom_histogram(binwidth = 5, alpha = 0.5, position = "identity") +
  labs(x = "Height",
       y = "Density") +
  facet_wrap(~sex)

p = ggplotly(p)
p

```

### Distribution of heights for the years 1880 and 1980

```{r}

p = ggplot(fr_data, aes(x = weight, fill = factor(year))) +
  geom_histogram(binwidth = 5, alpha = 0.5, position = "identity") +
  labs(x = "Weight",
       y = "Density") +
  facet_wrap(~sex)

p = ggplotly(p)
p

```

Column
-----------------------------------------------------------------------

### Distribution of BMI for the years 1880 and 1980

```{r}

p = ggplot(fr_data, aes(x = bmi, fill = factor(year))) +
  geom_density(alpha = 0.5) +
  labs(x = "BMI",
       y = "Density") +
  facet_wrap(~sex)

p = ggplotly(p)
p

```

### Comparison of average weight between the years 1880 and 1980

```{r}

p = ggplot(fr_data, aes(x = factor(year), y = weight, fill = factor(year))) +
  geom_boxplot() +
  labs(x = "Year",
       y = "Weight") +
  facet_wrap(~sex)

p = ggplotly(p)
p

```


France v country data
=======================================================================

Column
-----------------------------------------------------------------------

### Comparison of average weight between french people and selected country in selected year in selected sex

```{r}
output$weight_plot <- renderPlotly({
  p_weight <- ggplot(subset(data, country %in% c('FR', input$country) & sex %in% input$sex),
                     aes(x = factor(year), y = weight, fill = country)) +
    geom_bar(stat = "summary", fun = "mean", position = "dodge") +
    labs(x = "Year",
         y = "Average Weight",
         fill = "Country") +
    facet_wrap(~sex)

  ggplotly(p_weight)
})

plotlyOutput('weight_plot')
```

### Comparison of average height between french people and selected country in selected year in selected sex

```{r}
output$height_plot <- renderPlotly({
  p_height <- ggplot(subset(data, country %in% c('FR', input$country) & sex %in% input$sex),
                     aes(x = factor(year), y = height, fill = country)) +
    geom_bar(stat = "summary", fun = "mean", position = "dodge") +
    labs(x = "Year",
         y = "Average Height",
         fill = "Country") +
    facet_wrap(~sex)

  ggplotly(p_height)
})

plotlyOutput('height_plot')
```

Column
-----------------------------------------------------------------------

### Small 'data cloud' of weight by height data of selected sex in France and selected country

```{r}
output$scatter_plot <- renderPlotly({
  sampled_data <- data %>%
    filter(country %in% c('FR', input$country) & sex %in% input$sex) %>%
    group_by(country) %>%
    sample_n(150)

  p_scatter <- ggplot(sampled_data, aes(x = height, y = weight, color = country)) +
    geom_point(alpha = 0.7, size = 2) +
    labs(x = "Height",
         y = "Weight",
         color = "Country") +
    facet_wrap(~sex)

  ggplotly(p_scatter)
})

plotlyOutput('scatter_plot')
```

### Filters
```{r}
selectInput("country", "country:", choices = unique(data$country), selected = 'AF')
checkboxGroupInput("sex", "sex:", choices = unique(data$sex), selected = c("male", "female"))
```


All countries
=======================================================================

Column
-----------------------------------------------------------------------

### Histogram of selected parameter in selected countries (checkboxes)

```{r}

```

### Filters
```{r}
selectInput("parameter", "parameter:", choices = c('height', 'weight'), selected = 'height')
checkboxGroupInput("countries", "country:", choices = unique(data$country), selected = unique(data$country))
```

Column
-----------------------------------------------------------------------

### Dumbbell plot

```{r}
#dumbbell plot - all countries on Y axis and value of selected parameter on X axis
```

### Filters
```{r}
selectInput("dumbbell_parameter", "parameter:", choices = c('height', 'weight'), selected = 'height')
```
